<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<div th:fragment="documentViewer" class="modal fade" id="previewModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-xl modal-dialog-centered shadow-lg" style="max-width: 85vw;">
        <div class="modal-content border-0 rounded-4 overflow-hidden bg-white shadow-2xl">

            <div class="modal-header border-0 bg-white px-4 py-3 d-flex align-items-center justify-content-between">
                <div class="d-flex align-items-center">
                    <div class="p-2 bg-primary bg-opacity-10 rounded-circle me-3">
                        <i class="bi bi-shield-check text-primary fs-5"></i>
                    </div>
                    <div>
                        <h6 class="modal-title fw-bold text-dark mb-0" id="previewTitle">Medical Record Viewer</h6>
                        <small class="text-muted" style="font-size: 0.7rem;">SECURE ENCRYPTED ACCESS</small>
                    </div>
                </div>
                <div class="d-flex gap-2">
                    <button class="btn btn-light btn-sm rounded-circle shadow-sm" title="Print Record" onclick="window.print()">
                        <i class="bi bi-printer"></i>
                    </button>
                    <button type="button" class="btn-close ms-2" data-bs-dismiss="modal"></button>
                </div>
            </div>

            <div class="modal-body p-0">
                <div class="row g-0" style="height: 80vh;">

                    <div class="col-lg-8 bg-dark d-flex flex-column border-end position-relative">
                        <div class="position-absolute bottom-0 start-50 translate-middle-x mb-4 z-3">
                            <div class="btn-group bg-white shadow-lg rounded-pill p-1 border">
                                <button id="prevPage" class="btn btn-white border-0 rounded-circle px-3"><i class="bi bi-chevron-left"></i></button>
                                <div class="px-3 py-1 border-start border-end d-flex align-items-center">
                                    <span class="fw-bold small">
                                        <span id="pageNum" class="text-primary">1</span>
                                        <span class="text-muted mx-1">/</span>
                                        <span id="pageCount">--</span>
                                    </span>
                                </div>
                                <button id="nextPage" class="btn btn-white border-0 rounded-circle px-3"><i class="bi bi-chevron-right"></i></button>
                            </div>
                        </div>

                        <div id="pdf-viewer-container" class="flex-grow-1 overflow-auto d-flex justify-content-center align-items-start py-5"
                             style="background: radial-gradient(circle, #2c2c2c 0%, #1a1a1a 100%);">
                            <canvas id="pdf-render" class="shadow-2xl mb-5"></canvas>
                        </div>
                    </div>

                    <div class="col-lg-4 d-flex flex-column bg-white">
                        <div class="p-4 flex-grow-1 overflow-auto border-bottom">
                            <div class="d-flex align-items-center justify-content-between mb-3">
                                <span class="badge bg-secondary-subtle text-secondary px-3 py-2 rounded-pill small fw-bold">
                                    <i class="bi bi-clock-history me-1"></i> CLINICAL CHAIN
                                </span>
                            </div>
                            <div class="history-thread p-3 bg-light rounded-4 border-0"
                                 id="previousNotesDisplay"
                                 style="font-size: 0.85rem; line-height: 1.6; color: #4a5568;">
                            </div>
                        </div>

                        <div class="p-4 bg-white">
                            <label class="form-label fw-bold text-dark small mb-3">ADD ANALYSIS</label>
                            <div class="position-relative">
                                <textarea id="clinicalNotesInput"
                                          class="form-control border-0 bg-light p-3 rounded-4 shadow-inner"
                                          style="height: 140px; resize: none; font-size: 0.9rem;"
                                          placeholder="Enter findings..."></textarea>
                            </div>

                            <button id="saveNotesBtn" class="btn btn-primary w-100 rounded-4 py-3 mt-3 fw-bold shadow-sm transition-base">
                                <i class="bi bi-journal-plus me-2"></i> Commit to History
                            </button>

                            <div id="saveStatus" class="d-none mt-3 animate__animated animate__fadeIn">
                                <div class="alert alert-success d-flex align-items-center rounded-3 border-0 py-2">
                                    <i class="bi bi-check-all fs-4 me-2"></i>
                                    <span class="small fw-bold">Blockchain Record Updated</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <style>
        /* Glassmorphism & Modern Shadows */
        .shadow-2xl { box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5); }
        .shadow-inner { box-shadow: inset 0 2px 4px 0 rgba(0, 0, 0, 0.05); }
        .transition-base { transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1); }
        .transition-base:hover { transform: translateY(-1px); filter: brightness(1.1); }
        .transition-base:active { transform: translateY(0px) scale(0.98); }

        #pdf-viewer-container::-webkit-scrollbar { width: 6px; }
        #pdf-viewer-container::-webkit-scrollbar-thumb { background: #444; border-radius: 10px; }

        /* Typography */
        #previewTitle { letter-spacing: -0.02em; }
        .history-thread { border-left: 3px solid #e2e8f0; }
        /* Update your <style> block inside the fragment */
#pdf-viewer-container {
    height: 100%;            /* Force it to fill the column */
    overflow-y: auto !important; /* Enable vertical scrolling */
    overflow-x: auto !important; /* Enable horizontal scrolling if zoomed */
    display: block !important;   /* Ensure it behaves as a block for scrolling */
}

#pdf-render {
    display: block;
    margin: 0 auto;         /* Centers the PDF horizontally */
    max-width: 100%;        /* Prevents horizontal overflow on small screens */
    height: auto !important; /* Allows the canvas to expand vertically */
}
    </style>
</div>
</html>


<!--<button type="button"-->
<!--        class="btn btn-primary"-->
<!--        onclick="GlobalViewer.open('DOC_ID', 'Prescription #405', 'Existing patient history...')">-->
<!--    View Analysis-->
<!--</button>-->